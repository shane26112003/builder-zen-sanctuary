<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MetroReserve - Metro Seat Reservation System</title>
    <link rel="stylesheet" href="/styles/main.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="login-container">
      <div class="login-content">
        <div class="brand-section">
          <div class="brand-icon">
            <div class="mrs-logo">
              <span class="mrs-text">MRS</span>
              <div class="mrs-underline"></div>
            </div>
          </div>
          <h1 class="brand-title">MetroReserve</h1>
          <p class="brand-subtitle">Secure your journey with us</p>
        </div>

        <div class="login-card">
          <div class="card-header">
            <h2 class="card-title">Sign In</h2>
            <p class="card-description">
              Enter your credentials to access the metro reservation system
            </p>
          </div>

          <form id="loginForm" class="login-form">
            <div class="form-group">
              <label for="email" class="form-label">Email</label>
              <input
                type="email"
                id="email"
                class="form-input"
                placeholder="Enter your email"
                required
              />
            </div>

            <div class="form-group">
              <label for="password" class="form-label">Password</label>
              <input
                type="password"
                id="password"
                class="form-input"
                placeholder="Enter your password"
                required
              />
            </div>

            <div id="errorMessage" class="error-message" style="display: none">
              Invalid credentials. Please check your email and password.
            </div>

            <button type="submit" class="btn btn-primary" id="loginBtn">
              <span id="loginText">Sign In</span>
              <span id="loadingText" style="display: none">Signing In...</span>
            </button>
          </form>

          <div class="auth-divider">
            <span>or</span>
          </div>

          <button
            type="button"
            class="btn btn-secondary"
            id="signupBtn"
            style="width: 80%; margin-bottom: 1rem; right = 20vw"
          >
            Create New Account
          </button>

          <div class="demo-info">
            <p>New to MetroReserve? Create an account to get started</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Load unified auth system -->
    <script src="/scripts/unified-auth.js"></script>

    <script>
      // Initialize auth manager
      const authManager = new MetroAuthManager();
      window.authManager = authManager;

      // Check if already authenticated
      if (authManager.isAuthenticated()) {
        authManager.redirectBasedOnUser();
      }

      // DOM event handlers
      document.addEventListener("DOMContentLoaded", function () {
        const loginForm = document.getElementById("loginForm");
        const loginBtn = document.getElementById("loginBtn");
        const signupBtn = document.getElementById("signupBtn");
        const loginText = document.getElementById("loginText");
        const loadingText = document.getElementById("loadingText");
        const errorMessage = document.getElementById("errorMessage");

        // Sign in form handler
        loginForm.addEventListener("submit", async function (e) {
          e.preventDefault();

          const email = document.getElementById("email").value;
          const password = document.getElementById("password").value;

          // Show loading state
          loginBtn.disabled = true;
          loginText.style.display = "none";
          loadingText.style.display = "inline";
          errorMessage.style.display = "none";

          // Attempt sign in
          const result = await authManager.signIn(email, password);

          if (result.success) {
            // Success - redirect based on user type
            authManager.redirectBasedOnUser();
          } else {
            // Show error
            errorMessage.textContent = result.error;
            errorMessage.style.display = "block";

            // Reset loading state
            loginBtn.disabled = false;
            loginText.style.display = "inline";
            loadingText.style.display = "none";
          }
        });

        // Sign up button handler
        signupBtn.addEventListener("click", async function () {
          const email = document.getElementById("email").value;
          const password = document.getElementById("password").value;

          if (!email || !password) {
            errorMessage.textContent =
              "Please enter email and password to create an account";
            errorMessage.style.display = "block";
            return;
          }

          if (password.length < 6) {
            errorMessage.textContent =
              "Password must be at least 6 characters long";
            errorMessage.style.display = "block";
            return;
          }

          // Show loading state
          signupBtn.disabled = true;
          signupBtn.textContent = "Creating Account...";
          errorMessage.style.display = "none";

          // Attempt sign up
          const result = await authManager.signUp(email, password);

          if (result.success) {
            // Show success message
            errorMessage.style.backgroundColor = "#f0f9ff";
            errorMessage.style.borderColor = "#bae6fd";
            errorMessage.style.color = "#0369a1";
            errorMessage.textContent =
              "Account created successfully! Redirecting...";
            errorMessage.style.display = "block";

            // Redirect after success
            setTimeout(() => {
              authManager.redirectBasedOnUser();
            }, 1500);
          } else {
            // Show error
            errorMessage.textContent = result.error;
            errorMessage.style.display = "block";

            // Reset loading state
            signupBtn.disabled = false;
            signupBtn.textContent = "Create New Account";
          }
        });
      });
    </script>
  </body>
</html>
